name: Just_run_that_goddamn_editor

on: workflow_dispatch

jobs:
  run-unity:
    runs-on: self-hosted

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Run Unity Windows build
        shell: powershell
        run: |
          $unityExe   = "T:\UnityEditor\Editors\6000.0.49f1\Editor\Unity.exe"
          $methodName = "CommandBuild.BuildWindows"

          Write-Host $PWD
          Write-Host "=== Unity run starting ==="
          & $unityExe `
            -batchmode `
            -nographics `
            -projectPath "$PWD" `
            -executeMethod $methodName `
            -quit `
            -logFile - 2>&1 |
            Tee-Object -FilePath "unity-run.log"

          $exitCode = $LASTEXITCODE
          Write-Host "=== Unity exited with code $exitCode ==="

          if ($LASTEXITCODE -ne 0) {
            throw "Unity failed with exit code $LASTEXITCODE"
          }

      - name: Upload build artifact
        uses: actions/upload-artifact@v4
        with:
          name: Win-Build
          path: build/win